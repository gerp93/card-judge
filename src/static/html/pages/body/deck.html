{{define "body"}}
<script src="/static/js/deck.js"></script>
<div style="display: grid; grid-auto-flow: column">
    <h2>{{.Deck.Name}}</h2>
    <div style="text-align: right;">
        <button onclick="document.getElementById('card-create-dialog').showModal()">
            <span class="bi bi-plus-circle"></span> Create Card
        </button>
        <button onclick="document.getElementById('deck-update-dialog').showModal()">
            <span class="bi bi-pencil"></span> Edit Deck
        </button>
        <button
            title="Export Deck to CSV"
            hx-get="/api/deck/{{.Deck.Id}}/card-export"
            hx-target="#deck-card-export-content"
            hx-confirm="Are you sure you want to export deck cards to a CSV file?"
        >
            <span class="bi bi-download"></span> Export Deck
            <span
                id="deck-card-export-content"
                style="display: none"
            ></span>
        </button>
    </div>
</div>
<form id="table-filter-form">
    <label for="categorySearch">Category:</label>
    <select
        id="categorySearch"
        name="category"
        autocomplete="off"
        onchange="submitTableFilterForm()"
        required
    >
        {{if eq .Category "PROMPT"}}
        <option value="%">Any</option>
        <option
            value="PROMPT"
            selected
        >Prompt</option>
        <option value="RESPONSE">Response</option>
        {{else if eq .Category "RESPONSE"}}
        <option value="%">Any</option>
        <option value="PROMPT">Prompt</option>
        <option
            value="RESPONSE"
            selected
        >Response</option>
        {{else}}
        <option
            value="%"
            selected
        >Any</option>
        <option value="PROMPT">Prompt</option>
        <option value="RESPONSE">Response</option>
        {{end}}
    </select>
    <label for="textSearch">Search:</label>
    <input
        type="search"
        id="textSearch"
        name="text"
        maxlength="510"
        placeholder="Search..."
        value="{{.Text}}"
        autocomplete="off"
        onchange="submitTableFilterForm()"
    />

    {{if gt .Page 1}}
    <button onclick="goToTablePage(1)">
        <span class="bi bi-chevron-bar-left"></span>
    </button>
    <button onclick="goToPreviousTablePage()">
        <span class="bi bi-chevron-left"></span>
    </button>
    {{end}}

    <span>
        Page <input
            type="number"
            id="pageNumber"
            name="page"
            min="1"
            max="{{.LastPage}}"
            value="{{.Page}}"
            onchange="submitTableFilterForm()"
        /> of {{.LastPage}}
    </span>

    {{if lt .Page .LastPage}}
    <button onclick="goToNextTablePage()">
        <span class="bi bi-chevron-right"></span>
    </button>
    <button onclick="goToTablePage({{.LastPage}})">
        <span class="bi bi-chevron-bar-right"></span>
    </button>
    {{end}}
</form>
{{if eq .RowCount 0}}
No cards found with that search criteria.
{{else}}
<table>
    <thead>
        <tr>
            <th>Created</th>
            <th>Changed</th>
            <th>Edit</th>
            <th>Category</th>
            <th>Text</th>
            <th>YouTube</th>
            <th>Image</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody>
        {{range .Cards}}
        <tr>
            <td>{{.CreatedOnDate.Format "2006-01-02"}}</td>
            <td>{{.ChangedOnDate.Format "2006-01-02"}}</td>
            <td>
                <div style="text-align: center;">
                    <span
                        title="Edit Card"
                        class="bi bi-pencil clickable"
                        onclick="document.getElementById('card-{{.Id}}-update-dialog').showModal()"
                    ></span>
                </div>
                <dialog id="card-{{.Id}}-update-dialog">
                    <div style="display: grid; grid-auto-flow: column">
                        <div>
                            <h3>Edit Card</h3>
                        </div>
                        <div>
                            <span
                                class="bi bi-x-lg close-button"
                                onclick="document.getElementById('card-{{.Id}}-update-dialog').close()"
                            ></span>
                        </div>
                    </div>
                    <form
                        hx-put="/api/card/{{.Id}}"
                        hx-target="find .htmx-result"
                    >
                        <div class="form-input">
                            <input
                                type="text"
                                name="deckId"
                                value="{{.DeckId}}"
                                hidden
                            />
                            <label for="category{{.Id}}">Category</label>
                            <select
                                id="category{{.Id}}"
                                name="category"
                                autocomplete="off"
                                required="required"
                            >
                                {{if eq .Category "PROMPT"}}
                                <option
                                    value="PROMPT"
                                    selected
                                >Prompt</option>
                                <option value="RESPONSE">Response</option>
                                {{else}}
                                <option value="PROMPT">Prompt</option>
                                <option
                                    value="RESPONSE"
                                    selected
                                >Response</option>
                                {{end}}
                            </select>
                            <label
                                for="text{{.Id}}"
                                style="vertical-align: top"
                            >Text</label>
                            <textarea
                                id="text{{.Id}}"
                                name="text"
                                maxlength="510"
                                placeholder="Enter Text"
                                required="required"
                                cols="40"
                                rows="10"
                                autocomplete="off"
                            >{{.Text}}</textarea>
                            <label
                                for="youtube{{.Id}}"
                                style="vertical-align: top"
                            >YouTube Video ID</label>
                            <input
                                type="text"
                                id="youtube{{.Id}}"
                                name="youtube"
                                title="Must be 11 characters or empty"
                                pattern=".{11}|^$"
                                maxlength="11"
                                placeholder="Enter YouTube Video ID"
                                {{if .YouTube.Valid}}
                                value="{{.YouTube.String}}"
                                {{end}}
                                autocomplete="off"
                            />
                        </div>
                        <div class="htmx-result"></div>
                        <input
                            type="submit"
                            value="Update Card"
                        />
                    </form>
                    {{if .YouTube.Valid}}
                    <br />
                    <div class="iframe-container">
                        <iframe src="https://www.youtube.com/embed/{{.YouTube.String}}"></iframe>
                    </div>
                    {{end}}
                    <br />
                    <form
                        enctype="multipart/form-data"
                        hx-put="/api/card/{{.Id}}/image"
                        hx-target="find .htmx-result"
                    >
                        {{if .Image.Valid}}
                        <img
                            src="data:image;base64,{{.Image.String}}"
                            alt="Card Image"
                        />
                        {{end}}
                        <div class="form-input">
                            <input
                                type="file"
                                name="deckId"
                                value="{{.DeckId}}"
                                hidden
                            />
                            <label for="image{{.Id}}">Image</label>
                            <input
                                type="file"
                                id="image{{.Id}}"
                                name="image"
                                accept="image/*"
                                autocomplete="off"
                            />
                        </div>
                        <div class="htmx-result"></div>
                        <input
                            type="submit"
                            value="Set Image"
                        />
                    </form>
                    <br />
                </dialog>
            </td>
            <td>{{if eq .Category "PROMPT"}} Prompt {{else}} Response {{end}}</td>
            <td class="wrap-new-lines">{{.Text}}</td>
            <td>
                {{if .YouTube.Valid}}
                <div style="text-align: center;">
                    <span class="bi bi-youtube"></span>
                </div>
                {{end}}
            </td>
            <td>
                {{if .Image.Valid}}
                <div style="text-align: center;">
                    <span class="bi bi-card-image"></span>
                </div>
                {{end}}
            </td>
            <td>
                <div style="text-align: center;">
                    <span
                        title="Delete"
                        class="bi bi-trash clickable"
                        hx-delete="/api/card/{{.Id}}"
                        hx-confirm="Are you sure you want to delete this card?"
                    ></span>
                </div>
            </td>
        </tr>
        {{end}}
    </tbody>
</table>
{{end}}
<br />
<details class="danger-zone">
    <summary class="danger-zone-summary">
        <span class="bi bi-exclamation-triangle-fill"></span>
        Danger Zone
    </summary>
    <br />
    <p>
        Warning: This action cannot be undone. Deleting this deck will permanently remove all associated cards.
    </p>
    <button
        hx-delete="/api/deck/{{.Deck.Id}}"
        hx-confirm="Are you sure you want to delete this deck?"
    >
        <span class="bi bi-trash"></span>
        Delete Deck
    </button>
</details>
<br />
<br />
<dialog id="deck-update-dialog">
    <div style="display: grid; grid-auto-flow: column">
        <div>
            <h3>Edit Deck</h3>
        </div>
        <div>
            <span
                class="bi bi-x-lg close-button"
                onclick="document.getElementById('deck-update-dialog').close()"
            ></span>
        </div>
    </div>
    <h3>Set Deck Name</h3>
    <form
        hx-put="/api/deck/{{.Deck.Id}}/name"
        hx-target="find .htmx-result"
    >
        <div class="form-input">
            <label for="setDeckName">Deck Name</label>
            <input
                type="text"
                id="setDeckName"
                name="name"
                maxlength="255"
                placeholder="Enter Name"
                value="{{.Deck.Name}}"
                required="required"
                autocomplete="off"
            />
        </div>
        <br />
        <div class="htmx-result"></div>
        <input
            type="submit"
            value="Set Deck Name"
        />
    </form>
    <h3>Set Deck Password</h3>
    <form
        hx-put="/api/deck/{{.Deck.Id}}/password"
        hx-target="find .htmx-result"
    >
        <div class="form-input">
            <label for="currentPassword">Current Password</label>
            <input
                type="password"
                id="currentPassword"
                name="currentPassword"
                maxlength="255"
                placeholder="Current Password"
                required="required"
                autocomplete="password"
            />
            <label for="newPassword">New Password</label>
            <input
                type="password"
                id="newPassword"
                name="newPassword"
                maxlength="255"
                placeholder="New Password"
                required="required"
                autocomplete="new-password"
            />
            <label for="newPasswordConfirm">Confirm New Password</label>
            <input
                type="password"
                id="newPasswordConfirm"
                name="newPasswordConfirm"
                maxlength="255"
                placeholder="New Password Again"
                required="required"
                autocomplete="off"
            />
        </div>
        <div class="htmx-result"></div>
        <input
            type="submit"
            value="Change Password"
        />
    </form>
    <h3>Set Is Public Read-Only</h3>
    <form
        hx-put="/api/deck/{{.Deck.Id}}/is-public-read-only"
        hx-target="find .htmx-result"
    >
        <div class="form-input">
            <label for="setDeckIsPublicReadOnly">Is Public Read-Only</label>
            <select
                id="setDeckIsPublicReadOnly"
                name="isPublicReadOnly"
                autocomplete="off"
            >
                {{if .Deck.IsPublicReadOnly}}
                <option value="0">No</option>
                <option
                    value="1"
                    selected
                >Yes</option>
                {{else}}
                <option
                    value="0"
                    selected
                >No</option>
                <option value="1">Yes</option>
                {{end}}
            </select>
        </div>
        <br />
        <div class="htmx-result"></div>
        <input
            type="submit"
            value="Set Is Public Read-Only"
        />
    </form>
</dialog>
<dialog id="card-create-dialog">
    <div style="display: grid; grid-auto-flow: column">
        <div>
            <h3>Create Card</h3>
        </div>
        <div>
            <span
                class="bi bi-x-lg close-button"
                onclick="document.getElementById('card-create-dialog').close()"
            ></span>
        </div>
    </div>
    <form
        hx-post="/api/card/create"
        hx-target="find .htmx-result"
    >
        <div class="form-input">
            <input
                type="text"
                id="newCardDeckId"
                name="deckId"
                value="{{.Deck.Id}}"
                hidden
            />
            <label for="newCardCategory">Category</label>
            <select
                id="newCardCategory"
                name="category"
                autocomplete="off"
                required
            >
                <option value="PROMPT">Prompt</option>
                <option
                    value="RESPONSE"
                    selected
                >Response</option>
            </select>
            <label
                for="newCardText"
                style="vertical-align: top"
            >Text</label>
            <textarea
                id="newCardText"
                name="text"
                maxlength="255"
                placeholder="Enter New Card Text"
                required="required"
                cols="40"
                rows="10"
                autocomplete="off"
            ></textarea>
            <label
                for="newCardYouTube"
                style="vertical-align: top"
            >YouTube Video ID</label>
            <input
                type="text"
                id="newCardYouTube"
                name="youtube"
                title="Must be 11 characters or empty"
                pattern=".{11}|^$"
                maxlength="11"
                placeholder="Enter YouTube Video ID"
                autocomplete="off"
            />
        </div>
        <br />
        <div class="htmx-result"></div>
        <input
            type="submit"
            value="Create"
        />
    </form>
</dialog>
{{end}}